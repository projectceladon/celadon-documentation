

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Feature Delta Offered by Stable Releases (IoT) &mdash; Documentation for the Celadon Project</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User Guide" href="user-guide.html" />
    <link rel="prev" title="Stable Releases IoT" href="stable-release_iot.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Celadon Project
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">Guides and Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="stable-release_iot.html">Stable Releases IoT</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Feature Delta Offered by Stable Releases (IoT)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#real-time-clock-rtc-and-alarm-virtualization">Real-time clock (RTC) and alarm virtualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-data-erase">Secure data erase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html">User Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Celadon Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="stable-release_iot.html">Stable Releases IoT</a> &raquo;</li>
        
      <li>Feature Delta Offered by Stable Releases (IoT)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/stable-release_iot/feature-delta-iot.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="feature-delta-offered-by-stable-releases-iot">
<span id="feature-delta-iot"></span><h1>Feature Delta Offered by Stable Releases (IoT)</h1>
<p>Here are the additional features provided by Stable Releases (IoT).</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#real-time-clock-rtc-and-alarm-virtualization" id="id5">Real-time clock (RTC) and alarm virtualization</a></li>
<li><a class="reference internal" href="#secure-data-erase" id="id6">Secure data erase</a></li>
</ul>
</div>
<ul class="simple">
<li>100% Google* conformance on Comet Lake (CML),Tiger Lake (TGL), and
Elkhart Lake (EHL) with production ready</li>
<li>Supporting Comet Lake (CML),Tiger Lake (TGL), and Elkhart Lake (EHL)
on single baseline and Single Image</li>
<li>IoT configuration support GVT-d mode with 100% conformance</li>
<li>IoT configuration support GVT-g with no conformance</li>
</ul>
<div class="section" id="real-time-clock-rtc-and-alarm-virtualization">
<h2><a class="toc-backref" href="#id5">Real-time clock (RTC) and alarm virtualization</a></h2>
<p>The Celadon in Virtual Machine (CiV) project may require operations on the
RTC device, such as changes to current time and setups of alarm, to be
synced to host and persistent across reboots. RTC device is purely emulated
by QEMU and its state will be lost after exit of QEMU process, furthermore,
guest RTC alarm is unable to wake up the guest after host suspends, which is
the case in when using –host-pm-control option in CiV.</p>
<p>The solution is to modify the emulated RTC device so that it emits QMP
events upon certain operations and uses a QMP client running on host to
receive the QMP events and sync the operations to host accordingly.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/rtc.png"><img alt="../_images/rtc.png" src="../_images/rtc.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">Figure 1 : Architecture Diagram of RTC Time Virtualization</span></p>
</div>
<p>Whenever the guest RTC alarm time is set, QEMU emits an RTC_CHANGE
event to QMP client. The QMP client can then set up a host RTC alarm
accordingly.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/alarm.png"><img alt="../_images/alarm.png" src="../_images/alarm.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">Figure 2 : Architecture Diagram of RTC Alarm Virtualization</span></p>
</div>
<p>Whenever the expire time of the guest RTC alarm changes, QEMU emits an
RTC_ALARM event to the QMP client, and the QMP client can then set up a host
RTC alarm accordingly. In the case of host suspension, the host alarm wakes
up the host and notifies the QMP client. Then, the QMP client sends an
rtc-refresh-timer command to QEMU, to ensure that QEMU wakes up the guest.</p>
</div>
<div class="section" id="secure-data-erase">
<h2><a class="toc-backref" href="#id6">Secure data erase</a></h2>
<p>In Celadon, all partitions are inside a single guest virtual disk image file on
the host with the disk controller emulated by QEMU. The underlying actual
storage hardware technology be it magnetic or solid state is transparent to
the Android* VM.</p>
<p>As such, due to emulation, secure partition erase would be to fall back to
“byte-by-byte overwrite” to the virtual partition. This “byte-by-byte
overwrite” operation is not solid state storage friendly.</p>
<p>To provide secure data erase of data partition, following enhancement is
needed in CiV:</p>
<p>Addition of secure data erase to make use of storage controller hardware
secure erase feature, when it is supported in hardware to erase data
partition and only finally fall back to byte-by-byte override 0 when not
supported during Android recovery/wipe data process.</p>
<ol class="arabic">
<li><p class="first">Guest virtual disk image file enhancement</p>
<p>In CiV, all Android required partitions are resided in the same
guest virtual disk image file in host.</p>
<p>To support the enhancements to add secure data partition erase via
hardware controller secure erase where supported, the data partition
needs to be separated from the main Celadon CiV guest disk image
file. This allows to pass a true host partition to QEMU CiV launch
parameters as a separate emulated disk for secure data erase.</p>
</li>
</ol>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../_images/sde.png"><img alt="../_images/sde.png" src="../_images/sde.png" style="width: 750px;" /></a>
<p class="caption"><span class="caption-text">Figure 3 : Host/Guest VM disk/file view after SDE enhancements
illustrates the changes in CiV guest image file in the host</span></p>
</div>
<ol class="arabic" start="2">
<li><p class="first">Secure data erase enhancement</p>
<p>In AOSP for data partition erase, this is performed by recovery tool
when “–wipe-data” is written to <code class="docutils literal"><span class="pre">/cache/recovery/command</span></code>. In generic
AOSP data partition will have a secure partition wipe if it has
encryption keys for the volume before any reformatting of the
partition.</p>
<p>For SDE enhancement, to add secure erase of the data partition via
hardware controller feature, vsock communication between AOSP
recovery tool and host side daemon application is added to add data
partition secure erase prior to Android reformat of data partition.</p>
<p>The host side daemon application is added to perform secure data
partition wipe using hardware controller supported erase mechanism
such as via <code class="docutils literal"><span class="pre">BLKSECDISCARD/BLKDISCARD</span></code> command if supported before
falling back to <code class="docutils literal"><span class="pre">BLKZEROOUT</span></code> commands if none of the former are
supported.</p>
</li>
</ol>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../_images/sde_enc.png"><img alt="../_images/sde_enc.png" src="../_images/sde_enc.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">Figure 4 : Data partition secure erase</span></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="user-guide.html" class="btn btn-neutral float-right" title="User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="stable-release_iot.html" class="btn btn-neutral" title="Stable Releases IoT" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, BSD, MIT, Apache and GPL licenses.
      Last updated on Jan 05, 2023.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>